<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Servicio Social - Simeprode</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: white;
            border-right: 1px solid #e5e7eb;
            padding: 20px 0;
            position: relative;
        }

        .logo {
            display: flex;
            align-items: center;
            padding: 0 20px;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 8px;
        }

        .logo:hover {
            background-color: #f9fafb;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .logo-text {
            font-size: 18px;
            font-weight: bold;
            color: #3b82f6;
        }

        .logo-subtitle {
            font-size: 12px;
            color: #6b7280;
            margin-top: 2px;
        }

        /* Platform Selector */
        .platform-selector {
            position: relative;
            margin-bottom: 20px;
        }

        .platform-selector .logo {
            margin-bottom: 0;
        }

        .platform-dropdown {
            position: absolute;
            top: 100%;
            left: 20px;
            right: 20px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            z-index: 1000;
            display: none;
            overflow: hidden;
        }

        .platform-selector:hover .platform-dropdown {
            display: block;
        }

        .platform-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            text-decoration: none;
            color: #374151;
            transition: all 0.2s;
            border-bottom: 1px solid #f3f4f6;
        }

        .platform-option:last-child {
            border-bottom: none;
        }

        .platform-option:hover {
            background-color: #f9fafb;
            color: #111827;
        }

        .platform-option.active {
            background-color: #eff6ff;
            color: #3b82f6;
        }

        .platform-option-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-size: 16px;
            color: white;
            font-weight: bold;
        }

        .platform-option-icon.acolchado {
            background: linear-gradient(135deg, #16a34a, #15803d);
        }

        .platform-option-icon.mantenimiento {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        .platform-option-icon.servicio-social {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .platform-option-icon.inventario {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .platform-option-text {
            flex: 1;
        }

        .platform-option-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .platform-option-subtitle {
            font-size: 12px;
            color: #6b7280;
        }

        .user-info {
            padding: 0 20px;
            margin-bottom: 30px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 2px;
        }

        .user-role {
            font-size: 12px;
            color: #6b7280;
        }

        .user-status {
            display: flex;
            align-items: center;
            margin-top: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background-color: #16a34a;
            border-radius: 50%;
            margin-right: 6px;
        }

        .status-text {
            font-size: 12px;
            color: #16a34a;
        }

        /* Navigation */
        .nav {
            list-style: none;
            padding: 0 20px;
        }

        .nav-item {
            margin-bottom: 4px;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            text-decoration: none;
            color: #6b7280;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .nav-link:hover {
            background-color: #f9fafb;
            color: #374151;
        }

        .nav-link.active {
            background-color: #eff6ff;
            color: #3b82f6;
        }

        .nav-icon {
            width: 20px;
            margin-right: 12px;
            font-size: 16px;
        }

        /* Logout */
        .logout {
            padding: 0 20px;
            margin-top: auto;
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
        }

        .logout-link {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            text-decoration: none;
            color: #dc2626;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .logout-link:hover {
            background-color: #fef2f2;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
        }

        .header-title {
            font-size: 28px;
            font-weight: bold;
            color: #111827;
            margin-bottom: 4px;
        }

        .header-subtitle {
            font-size: 16px;
            color: #6b7280;
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background-color: #2563eb;
        }

        .btn-secondary {
            background-color: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background-color: #e5e7eb;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }

        .stat-header {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            font-size: 24px;
        }

        .stat-icon.active {
            background: linear-gradient(135deg, #16a34a, #15803d);
            color: white;
        }

        .stat-icon.completed {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
        }

        .stat-icon.pending {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .stat-icon.total {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .stat-title {
            font-size: 14px;
            color: #6b7280;
            font-weight: 500;
        }

        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #111827;
            margin-bottom: 4px;
        }

        .stat-unit {
            font-size: 16px;
            color: #6b7280;
            font-weight: normal;
        }

        /* Chart Section */
        .chart-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            height: 300px;
            position: relative;
        }

        .chart-header {
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }

        .chart-subtitle {
            font-size: 14px;
            color: #6b7280;
        }

        .chart-container canvas {
            max-height: 200px !important;
            width: 100% !important;
        }

        /* Google Sheets-like Table Filters */
        .filterable-header {
            position: relative;
            cursor: pointer;
            user-select: none;
        }

        .filterable-header:hover {
            background-color: #f3f4f6;
        }

        .filter-icon {
            margin-left: 8px;
            font-size: 12px;
            color: #9ca3af;
            transition: color 0.2s;
        }

        .filterable-header:hover .filter-icon {
            color: #6b7280;
        }

        .filterable-header.has-filter .filter-icon {
            color: #3b82f6;
        }

        .filter-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 200px;
            background: white;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
            margin-top: 4px;
            max-height: 300px;
            flex-direction: column;
        }

        .filter-dropdown.dropdown-up {
            top: auto;
            bottom: 100%;
            margin-top: 0;
            margin-bottom: 4px;
        }

        .filter-dropdown.show {
            display: flex;
        }

        .filter-header {
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
            border-radius: 8px 8px 0 0;
        }

        .filter-title {
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        .filter-content {
            padding: 12px 16px;
            flex: 1;
            overflow-y: auto;
            max-height: 200px;
        }

        .filter-search {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            margin-bottom: 12px;
        }

        .filter-search:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        .filter-options {
            overflow-y: auto;
        }

        .filter-option {
            display: flex;
            align-items: center;
            padding: 8px 0;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .filter-option:hover {
            background-color: #f3f4f6;
        }

        .filter-option input[type="checkbox"] {
            margin-right: 8px;
            accent-color: #3b82f6;
        }

        .filter-option label {
            cursor: pointer;
            font-size: 14px;
            color: #374151;
            flex: 1;
        }

        .filter-actions {
            padding: 12px 16px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            gap: 8px;
            justify-content: space-between;
            align-items: center;
            background: white;
            border-radius: 0 0 8px 8px;
            flex-shrink: 0;
        }

        .sort-controls {
            display: flex;
            gap: 4px;
            align-items: center;
        }

        .sort-btn {
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .sort-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .sort-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
        }

        .filter-btn {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .filter-btn.clear {
            background: white;
            color: #6b7280;
        }

        .filter-btn.clear:hover {
            background: #f9fafb;
        }

        .filter-btn.apply {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .filter-btn.apply:hover {
            background: #2563eb;
        }

        .filter-btn.apply:disabled {
            background: #9ca3af;
            border-color: #9ca3af;
            cursor: not-allowed;
        }

        .active-filter-indicator {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 6px;
            height: 6px;
            background: #3b82f6;
            border-radius: 50%;
        }

        /* Sections */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: visible;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
            position: relative;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background-color: #f9fafb;
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
        }

        .table td {
            padding: 16px;
            border-bottom: 1px solid #f3f4f6;
            color: #374151;
        }

        .table tr:hover {
            background-color: #f9fafb;
        }

        /* Status badges */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-active {
            background-color: #dcfce7;
            color: #16a34a;
        }

        .status-completed {
            background-color: #dbeafe;
            color: #2563eb;
        }

        .status-pending {
            background-color: #fef3c7;
            color: #d97706;
        }

        /* Progress bar */
        .progress-bar {
            width: 100px;
            height: 8px;
            background-color: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 4px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #16a34a, #15803d);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        /* Attendance styles */
        .attendance-container {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }

        .attendance-header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .attendance-header h2 {
            font-size: 20px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .attendance-header p {
            font-size: 14px;
            color: #6b7280;
        }

        .attendance-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .attendance-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background-color: #f9fafb;
        }

        .student-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .student-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }

        .student-details h3 {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 4px;
        }

        .student-details p {
            font-size: 12px;
            color: #6b7280;
        }

        .attendance-controls {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .equipment-checklist {
            display: flex;
            gap: 16px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #374151;
            cursor: pointer;
        }

        .checkbox-label input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: #16a34a;
        }

        .btn-success {
            background-color: #16a34a;
            color: white;
        }

        .btn-success:hover {
            background-color: #15803d;
        }

        .btn-warning {
            background-color: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background-color: #d97706;
        }

        /* File upload */
        .file-upload {
            background: white;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            border: 2px dashed #d1d5db;
            transition: all 0.2s;
        }

        .file-upload:hover {
            border-color: #3b82f6;
            background-color: #f8fafc;
        }

        .file-upload.dragover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }

        .upload-icon {
            font-size: 48px;
            color: #9ca3af;
            margin-bottom: 16px;
        }

        .upload-title {
            font-size: 18px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }

        .upload-subtitle {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 24px;
        }

        .file-input {
            display: none;
        }

        /* Toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            min-width: 280px;
            max-width: 420px;
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-left-width: 4px;
            border-radius: 10px;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            padding: 12px 14px;
            color: #374151;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            animation: toast-in 200ms ease-out;
            transition: opacity 150ms ease, transform 150ms ease;
            margin-bottom: 10px;
        }
        .toast-success { border-left-color: #16a34a; }
        .toast-error { border-left-color: #dc2626; }
        .toast-message { flex: 1; font-size: 14px; line-height: 1.35; }
        .toast-close {
            background: transparent;
            border: none;
            color: #9ca3af;
            font-size: 18px;
            line-height: 1;
            cursor: pointer;
            padding: 0 2px;
        }
        .toast-close:hover { color: #6b7280; }
                 .toast.hide { opacity: 0; transform: translateX(8px); }
         @keyframes toast-in { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } }

         /* Modal styles */
         .modal-overlay {
             position: fixed;
             top: 0;
             left: 0;
             right: 0;
             bottom: 0;
             background-color: rgba(0, 0, 0, 0.5);
             display: flex;
             align-items: center;
             justify-content: center;
             z-index: 2000;
             opacity: 0;
             visibility: hidden;
             transition: all 0.3s ease;
         }

         .modal-overlay.show {
             opacity: 1;
             visibility: visible;
         }

         .modal {
             background: white;
             border-radius: 12px;
             box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
             max-width: 800px;
             width: 90%;
             max-height: 80vh;
             overflow-y: auto;
             transform: scale(0.9);
             transition: transform 0.3s ease;
         }

         .modal.show {
             transform: scale(1);
         }

         .modal-header {
             padding: 24px;
             border-bottom: 1px solid #e5e7eb;
             display: flex;
             justify-content: space-between;
             align-items: center;
         }

         .modal-title {
             font-size: 20px;
             font-weight: 600;
             color: #111827;
         }

         .modal-close {
             background: transparent;
             border: none;
             font-size: 24px;
             color: #6b7280;
             cursor: pointer;
             padding: 4px;
             border-radius: 4px;
             transition: all 0.2s;
         }

         .modal-close:hover {
             background-color: #f3f4f6;
             color: #374151;
         }

         .modal-body {
             padding: 24px;
         }

         .student-profile {
             display: flex;
             align-items: center;
             gap: 16px;
             margin-bottom: 24px;
             padding-bottom: 16px;
             border-bottom: 1px solid #e5e7eb;
         }

         .student-profile-avatar {
             width: 60px;
             height: 60px;
             background: linear-gradient(135deg, #3b82f6, #2563eb);
             border-radius: 50%;
             display: flex;
             align-items: center;
             justify-content: center;
             color: white;
             font-weight: bold;
             font-size: 20px;
         }

         .student-profile-info h3 {
             font-size: 18px;
             font-weight: 600;
             color: #111827;
             margin-bottom: 4px;
         }

         .student-profile-info p {
             font-size: 14px;
             color: #6b7280;
             margin-bottom: 2px;
         }

         .history-section {
             margin-bottom: 24px;
         }

         .history-section-title {
             font-size: 16px;
             font-weight: 600;
             color: #111827;
             margin-bottom: 12px;
             display: flex;
             align-items: center;
             gap: 8px;
         }

         .history-item {
             border: 1px solid #e5e7eb;
             border-radius: 8px;
             margin-bottom: 12px;
             background-color: #f9fafb;
             overflow: hidden;
         }

         .history-item:hover {
             background-color: #f3f4f6;
         }

         .history-header {
             display: flex;
             justify-content: space-between;
             align-items: center;
             padding: 12px 16px;
             background-color: #f3f4f6;
             border-bottom: 1px solid #e5e7eb;
         }

         .history-info {
             flex: 1;
         }

         .history-activity {
             font-weight: 500;
             color: #111827;
             margin-bottom: 4px;
         }

         .history-details {
             font-size: 12px;
             color: #6b7280;
         }

         .history-hours {
             font-weight: 600;
             color: #111827;
         }

         .history-date {
             font-size: 12px;
             color: #6b7280;
             text-align: right;
         }

         .history-body {
             padding: 12px 16px;
         }

         .history-fields {
             display: grid;
             grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
             gap: 12px;
             margin-bottom: 8px;
         }

         .history-field {
             display: flex;
             flex-direction: column;
         }

         .history-field-label {
             font-size: 11px;
             color: #6b7280;
             font-weight: 500;
             text-transform: uppercase;
             margin-bottom: 2px;
         }

         .history-field-value {
             font-size: 13px;
             color: #111827;
             font-weight: 500;
         }

         .history-description {
             margin-top: 8px;
             padding: 8px 12px;
             background-color: #f8fafc;
             border-left: 3px solid #3b82f6;
             border-radius: 4px;
         }

         .history-description-label {
             font-size: 11px;
             color: #6b7280;
             font-weight: 500;
             text-transform: uppercase;
             margin-bottom: 4px;
         }

         .history-description-text {
             font-size: 13px;
             color: #111827;
             line-height: 1.4;
         }

         .history-note {
             margin-top: 8px;
             padding: 8px 12px;
             background-color: #fef3c7;
             border-left: 3px solid #f59e0b;
             border-radius: 4px;
         }

         .history-note-label {
             font-size: 11px;
             color: #92400e;
             font-weight: 500;
             text-transform: uppercase;
             margin-bottom: 4px;
         }

         .history-note-text {
             font-size: 13px;
             color: #92400e;
             line-height: 1.4;
         }

         .history-actions {
             display: flex;
             gap: 8px;
             margin-top: 12px;
             padding-top: 12px;
             border-top: 1px solid #e5e7eb;
         }

         .btn-edit {
             background-color: #3b82f6;
             color: white;
             border: none;
             padding: 6px 12px;
             border-radius: 4px;
             font-size: 12px;
             cursor: pointer;
             transition: background-color 0.2s;
         }

         .btn-edit:hover {
             background-color: #2563eb;
         }

         .btn-save {
             background-color: #10b981;
             color: white;
             border: none;
             padding: 6px 12px;
             border-radius: 4px;
             font-size: 12px;
             cursor: pointer;
             transition: background-color 0.2s;
         }

         .btn-save:hover {
             background-color: #059669;
         }

         .btn-cancel {
             background-color: #6b7280;
             color: white;
             border: none;
             padding: 6px 12px;
             border-radius: 4px;
             font-size: 12px;
             cursor: pointer;
             transition: background-color 0.2s;
         }

         .btn-cancel:hover {
             background-color: #4b5563;
         }

         .history-field-input {
             font-size: 13px;
             color: #111827;
             font-weight: 500;
             border: 1px solid #d1d5db;
             border-radius: 4px;
             padding: 4px 8px;
             background-color: white;
             width: 100%;
         }

         .history-field-input:focus {
             outline: none;
             border-color: #3b82f6;
             box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
         }

         .history-description-input {
             font-size: 13px;
             color: #111827;
             line-height: 1.4;
             border: 1px solid #d1d5db;
             border-radius: 4px;
             padding: 8px 12px;
             background-color: white;
             width: 100%;
             resize: vertical;
             min-height: 60px;
         }

         .history-description-input:focus {
             outline: none;
             border-color: #3b82f6;
             box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
         }

         .history-note-input {
             font-size: 13px;
             color: #92400e;
             line-height: 1.4;
             border: 1px solid #fbbf24;
             border-radius: 4px;
             padding: 8px 12px;
             background-color: #fef3c7;
             width: 100%;
             resize: vertical;
             min-height: 40px;
         }

         .history-note-input:focus {
             outline: none;
             border-color: #f59e0b;
             box-shadow: 0 0 0 2px rgba(245, 158, 11, 0.1);
         }

         .history-hours {
             font-weight: 600;
             color: #111827;
         }

         .history-date {
             font-size: 12px;
             color: #6b7280;
             text-align: right;
         }

         .total-hours {
             background: linear-gradient(135deg, #3b82f6, #2563eb);
             color: white;
             padding: 16px;
             border-radius: 8px;
             text-align: center;
             margin-top: 16px;
         }

         .total-hours h4 {
             font-size: 14px;
             margin-bottom: 4px;
             opacity: 0.9;
         }

         .total-hours .total-value {
             font-size: 24px;
             font-weight: bold;
         }
     </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="platform-selector">
                <div class="logo">
                    <div class="logo-icon">üë®‚Äçüéì</div>
                    <div>
                        <div class="logo-text">Servicio Social</div>
                        <div class="logo-subtitle">Control de Horas Estudiantiles</div>
                    </div>
                </div>
                <div class="platform-dropdown">
                    <a href="index.html" class="platform-option">
                        <div class="platform-option-icon acolchado">üå±</div>
                        <div class="platform-option-text">
                            <div class="platform-option-title">Acolchado Vegetal</div>
                            <div class="platform-option-subtitle">Control de consumo</div>
                        </div>
                    </a>
                    <a href="mantenimiento.html" class="platform-option">
                        <div class="platform-option-icon mantenimiento">üîß</div>
                        <div class="platform-option-text">
                            <div class="platform-option-title">Mantenimiento</div>
                            <div class="platform-option-subtitle">Gesti√≥n de equipos</div>
                        </div>
                    </a>
                    <a href="servicio-social.html" class="platform-option active">
                        <div class="platform-option-icon servicio-social">üë•</div>
                        <div class="platform-option-text">
                            <div class="platform-option-title">Servicio Social</div>
                            <div class="platform-option-subtitle">Gesti√≥n de voluntarios</div>
                        </div>
                    </a>
                    <a href="inventario.html" class="platform-option">
                        <div class="platform-option-icon inventario">üì¶</div>
                        <div class="platform-option-text">
                            <div class="platform-option-title">Inventario Activos</div>
                            <div class="platform-option-subtitle">Control por camioneta</div>
                        </div>
                    </a>
                </div>
            </div>
            
            <div class="user-info">
                <div class="user-avatar">C</div>
                <div class="user-name">Coordinador</div>
                <div class="user-role">Servicio Social</div>
                <div class="user-status">
                    <div class="status-dot"></div>
                    <div class="status-text">Activo</div>
                </div>
            </div>

            <nav>
                <ul class="nav">
                    <li class="nav-item">
                        <a href="#" class="nav-link active" data-section="resumen">
                            <div class="nav-icon">üìä</div>
                            Resumen
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="alumnos">
                            <div class="nav-icon">üë®‚Äçüéì</div>
                            Alumnos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="bonos">
                            <div class="nav-icon">üéÅ</div>
                            Bonos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="asistencia">
                            <div class="nav-icon">‚úÖ</div>
                            Asistencia
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#" class="nav-link" data-section="sanciones">
                            <div class="nav-icon">‚ö†Ô∏è</div>
                            Sanciones
                        </a>
                    </li>
                </ul>
            </nav>

            <div class="logout">
                <a href="#" class="logout-link">
                    <div class="nav-icon">üö™</div>
                    Cerrar Sesi√≥n
                </a>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Resumen Section -->
            <div id="resumen" class="section active">
                <header class="header">
                    <div>
                        <h1 class="header-title">Control de Servicio Social</h1>
                        <p class="header-subtitle">Dashboard de progreso de horas estudiantiles</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportData()">üì• Exportar</button>
                        <button class="btn btn-primary" onclick="showSection('alumnos')">üë®‚Äçüéì Ver Alumnos</button>
                    </div>
                </header>

                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon active"></div>
                            <div class="stat-title">Alumnos Activos</div>
                        </div>
                        <div class="stat-value" id="stat-active">9</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon completed"></div>
                            <div class="stat-title">Horas Completadas</div>
                        </div>
                        <div class="stat-value" id="stat-completed">1,410<span class="stat-unit">hrs</span></div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon pending"></div>
                            <div class="stat-title">Por Graduarse Pronto</div>
                        </div>
                        <div class="stat-value" id="stat-graduating">0<span class="stat-unit">alumnos</span></div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon total"></div>
                            <div class="stat-title">Meta Total</div>
                        </div>
                        <div class="stat-value" id="stat-total">4,320<span class="stat-unit">hrs</span></div>
                    </div>
                </div>

                <!-- Chart Section -->
                <div class="chart-section">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h2 class="chart-title">Progreso de Horas por Alumno</h2>
                            <p class="chart-subtitle">Comparaci√≥n del progreso hacia la meta individual</p>
                        </div>
                        <canvas id="progressChart" width="400" height="150"></canvas>
                    </div>
                </div>

                <!-- Recent Activities Section -->
                <div class="table-container">
                    <div style="padding: 24px; border-bottom: 1px solid #e5e7eb;">
                        <h2 style="font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 4px;">Actividades Recientes</h2>
                        <p style="font-size: 14px; color: #6b7280;">√öltimas actividades registradas de alumnos</p>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Alumno</th>
                                <th>Actividad</th>
                                <th>Horas</th>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="recent-activities-table">
                            <tr>
                                <td>Eugenio Mijares</td>
                                <td>Limpieza de √Åreas Verdes</td>
                                <td>4 hrs</td>
                                <td>15/01/2025</td>
                                <td>Servicio</td>
                                <td><span class="status-badge status-completed">Completado</span></td>
                            </tr>
                            <tr>
                                <td>Sebasti√°n Gonz√°lez Alfaro</td>
                                <td>Apoyo en Mantenimiento</td>
                                <td>3 hrs</td>
                                <td>14/01/2025</td>
                                <td>Servicio</td>
                                <td><span class="status-badge status-active">En curso</span></td>
                            </tr>
                            <tr>
                                <td>Paula Cantu Ceniceros</td>
                                <td>Bono por Excelencia</td>
                                <td>+2 hrs</td>
                                <td>13/01/2025</td>
                                <td>Bono</td>
                                <td><span class="status-badge status-completed">Aplicado</span></td>
                            </tr>
                            <tr>
                                <td>Diego De La Garza Fern√°ndez</td>
                                <td>Capacitaci√≥n de Seguridad</td>
                                <td>2 hrs</td>
                                <td>12/01/2025</td>
                                <td>Capacitaci√≥n</td>
                                <td><span class="status-badge status-completed">Completado</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Alumnos Section -->
            <div id="alumnos" class="section">
                <header class="header">
                    <div>
                        <h1 class="header-title">Gesti√≥n de Alumnos</h1>
                        <p class="header-subtitle">Lista completa de estudiantes y su progreso de horas</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportStudents()">üì• Exportar</button>
                        <button class="btn btn-primary" onclick="addStudent()">‚ûï Agregar Alumno</button>
                    </div>
                </header>

                <div class="table-container">
                    <table class="table" id="students-table-main">
                        <thead>
                            <tr>
                                <th class="filterable-header" data-column="matricula">
                                    Matr√≠cula
                                    <span class="filter-icon">üîΩ</span>
                                    <div class="active-filter-indicator" style="display: none;"></div>
                                    <div class="filter-dropdown">
                                        <div class="filter-header">
                                            <div class="filter-title">Filtrar por Matr√≠cula</div>
                                        </div>
                                        <div class="filter-content">
                                            <input type="text" class="filter-search" placeholder="Buscar matr√≠cula...">
                                            <div class="filter-options"></div>
                                        </div>
                                        <div class="filter-actions">
                                            <div class="sort-controls">
                                                <span style="font-size: 11px; color: #6b7280; margin-right: 4px;">Ordenar:</span>
                                                <button class="sort-btn sort-asc" data-sort="asc">
                                                    <span>‚Üë</span> Asc
                                                </button>
                                                <button class="sort-btn sort-desc" data-sort="desc">
                                                    <span>‚Üì</span> Desc
                                                </button>
                                            </div>
                                            <div class="filter-buttons">
                                                <button class="filter-btn clear">Limpiar</button>
                                                <button class="filter-btn apply">Aplicar</button>
                                            </div>
                                        </div>
                                    </div>
                                </th>
                                <th class="filterable-header" data-column="nombre">
                                    Nombre
                                    <span class="filter-icon">üîΩ</span>
                                    <div class="active-filter-indicator" style="display: none;"></div>
                                    <div class="filter-dropdown">
                                        <div class="filter-header">
                                            <div class="filter-title">Filtrar por Nombre</div>
                                        </div>
                                        <div class="filter-content">
                                            <input type="text" class="filter-search" placeholder="Buscar nombre...">
                                            <div class="filter-options"></div>
                                        </div>
                                        <div class="filter-actions">
                                            <div class="sort-controls">
                                                <span style="font-size: 11px; color: #6b7280; margin-right: 4px;">Ordenar:</span>
                                                <button class="sort-btn sort-asc" data-sort="asc">
                                                    <span>‚Üë</span> Asc
                                                </button>
                                                <button class="sort-btn sort-desc" data-sort="desc">
                                                    <span>‚Üì</span> Desc
                                                </button>
                                            </div>
                                            <div class="filter-buttons">
                                                <button class="filter-btn clear">Limpiar</button>
                                                <button class="filter-btn apply">Aplicar</button>
                                            </div>
                                        </div>
                                    </div>
                                </th>
                                <th class="filterable-header" data-column="universidad">
                                    Universidad
                                    <span class="filter-icon">üîΩ</span>
                                    <div class="active-filter-indicator" style="display: none;"></div>
                                    <div class="filter-dropdown">
                                        <div class="filter-header">
                                            <div class="filter-title">Filtrar por Universidad</div>
                                        </div>
                                        <div class="filter-content">
                                            <input type="text" class="filter-search" placeholder="Buscar universidad...">
                                            <div class="filter-options"></div>
                                        </div>
                                        <div class="filter-actions">
                                            <div class="sort-controls">
                                                <span style="font-size: 11px; color: #6b7280; margin-right: 4px;">Ordenar:</span>
                                                <button class="sort-btn sort-asc" data-sort="asc">
                                                    <span>‚Üë</span> Asc
                                                </button>
                                                <button class="sort-btn sort-desc" data-sort="desc">
                                                    <span>‚Üì</span> Desc
                                                </button>
                                            </div>
                                            <div class="filter-buttons">
                                                <button class="filter-btn clear">Limpiar</button>
                                                <button class="filter-btn apply">Aplicar</button>
                                            </div>
                                        </div>
                                    </div>
                                </th>
                                <th class="filterable-header" data-column="fecha">
                                    Fecha Inicio
                                    <span class="filter-icon">üîΩ</span>
                                    <div class="active-filter-indicator" style="display: none;"></div>
                                    <div class="filter-dropdown">
                                        <div class="filter-header">
                                            <div class="filter-title">Filtrar por Fecha</div>
                                        </div>
                                        <div class="filter-content">
                                            <input type="text" class="filter-search" placeholder="Buscar fecha...">
                                            <div class="filter-options"></div>
                                        </div>
                                        <div class="filter-actions">
                                            <div class="sort-controls">
                                                <span style="font-size: 11px; color: #6b7280; margin-right: 4px;">Ordenar:</span>
                                                <button class="sort-btn sort-asc" data-sort="asc">
                                                    <span>‚Üë</span> Asc
                                                </button>
                                                <button class="sort-btn sort-desc" data-sort="desc">
                                                    <span>‚Üì</span> Desc
                                                </button>
                                            </div>
                                            <div class="filter-buttons">
                                                <button class="filter-btn clear">Limpiar</button>
                                                <button class="filter-btn apply">Aplicar</button>
                                            </div>
                                        </div>
                                    </div>
                                </th>
                                <th class="filterable-header" data-column="horas">
                                    Horas Acumuladas
                                    <span class="filter-icon">üîΩ</span>
                                    <div class="active-filter-indicator" style="display: none;"></div>
                                    <div class="filter-dropdown">
                                        <div class="filter-header">
                                            <div class="filter-title">Filtrar por Horas</div>
                                        </div>
                                        <div class="filter-content">
                                            <input type="text" class="filter-search" placeholder="Buscar horas...">
                                            <div class="filter-options"></div>
                                        </div>
                                        <div class="filter-actions">
                                            <div class="sort-controls">
                                                <span style="font-size: 11px; color: #6b7280; margin-right: 4px;">Ordenar:</span>
                                                <button class="sort-btn sort-asc" data-sort="asc">
                                                    <span>‚Üë</span> Asc
                                                </button>
                                                <button class="sort-btn sort-desc" data-sort="desc">
                                                    <span>‚Üì</span> Desc
                                                </button>
                                            </div>
                                            <div class="filter-buttons">
                                                <button class="filter-btn clear">Limpiar</button>
                                                <button class="filter-btn apply">Aplicar</button>
                                            </div>
                                        </div>
                                    </div>
                                </th>
                                <th class="filterable-header" data-column="meta">
                                    Meta de Horas
                                    <span class="filter-icon">üîΩ</span>
                                    <div class="active-filter-indicator" style="display: none;"></div>
                                    <div class="filter-dropdown">
                                        <div class="filter-header">
                                            <div class="filter-title">Filtrar por Meta</div>
                                        </div>
                                        <div class="filter-content">
                                            <input type="text" class="filter-search" placeholder="Buscar meta...">
                                            <div class="filter-options"></div>
                                        </div>
                                        <div class="filter-actions">
                                            <div class="sort-controls">
                                                <span style="font-size: 11px; color: #6b7280; margin-right: 4px;">Ordenar:</span>
                                                <button class="sort-btn sort-asc" data-sort="asc">
                                                    <span>‚Üë</span> Asc
                                                </button>
                                                <button class="sort-btn sort-desc" data-sort="desc">
                                                    <span>‚Üì</span> Desc
                                                </button>
                                            </div>
                                            <div class="filter-buttons">
                                                <button class="filter-btn clear">Limpiar</button>
                                                <button class="filter-btn apply">Aplicar</button>
                                            </div>
                                        </div>
                                    </div>
                                </th>
                                <th class="filterable-header" data-column="progreso">
                                    Progreso
                                    <span class="filter-icon">üîΩ</span>
                                    <div class="active-filter-indicator" style="display: none;"></div>
                                    <div class="filter-dropdown">
                                        <div class="filter-header">
                                            <div class="filter-title">Filtrar por Progreso</div>
                                        </div>
                                        <div class="filter-content">
                                            <input type="text" class="filter-search" placeholder="Buscar progreso...">
                                            <div class="filter-options"></div>
                                        </div>
                                        <div class="filter-actions">
                                            <div class="sort-controls">
                                                <span style="font-size: 11px; color: #6b7280; margin-right: 4px;">Ordenar:</span>
                                                <button class="sort-btn sort-asc" data-sort="asc">
                                                    <span>‚Üë</span> Asc
                                                </button>
                                                <button class="sort-btn sort-desc" data-sort="desc">
                                                    <span>‚Üì</span> Desc
                                                </button>
                                            </div>
                                            <div class="filter-buttons">
                                                <button class="filter-btn clear">Limpiar</button>
                                                <button class="filter-btn apply">Aplicar</button>
                                            </div>
                                        </div>
                                    </div>
                                </th>
                                <th class="filterable-header" data-column="estado">
                                    Estado
                                    <span class="filter-icon">üîΩ</span>
                                    <div class="active-filter-indicator" style="display: none;"></div>
                                    <div class="filter-dropdown">
                                        <div class="filter-header">
                                            <div class="filter-title">Filtrar por Estado</div>
                                        </div>
                                        <div class="filter-content">
                                            <input type="text" class="filter-search" placeholder="Buscar estado...">
                                            <div class="filter-options"></div>
                                        </div>
                                        <div class="filter-actions">
                                            <div class="sort-controls">
                                                <span style="font-size: 11px; color: #6b7280; margin-right: 4px;">Ordenar:</span>
                                                <button class="sort-btn sort-asc" data-sort="asc">
                                                    <span>‚Üë</span> Asc
                                                </button>
                                                <button class="sort-btn sort-desc" data-sort="desc">
                                                    <span>‚Üì</span> Desc
                                                </button>
                                            </div>
                                            <div class="filter-buttons">
                                                <button class="filter-btn clear">Limpiar</button>
                                                <button class="filter-btn apply">Aplicar</button>
                                            </div>
                                        </div>
                                    </div>
                                </th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="students-table">
                            <tr>
                                <td>633059</td>
                                <td>Eugenio Mijares</td>
                                <td>UDEM</td>
                                <td>01/09/2024</td>
                                <td>267:40 hrs</td>
                                <td>480 hrs</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 56%"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #6b7280;">56%</span>
                                </td>
                                <td><span class="status-badge status-active">Activo</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewStudentHistory('633059')">Ver Historial</button>
                                </td>
                            </tr>
                            <tr>
                                <td>595002</td>
                                <td>Sebasti√°n Gonz√°lez Alfaro</td>
                                <td>UDEM</td>
                                <td>15/08/2024</td>
                                <td>194:00 hrs</td>
                                <td>480 hrs</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 40%"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #6b7280;">40%</span>
                                </td>
                                <td><span class="status-badge status-active">Activo</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewStudentHistory('595002')">Ver Historial</button>
                                </td>
                            </tr>
                            <tr>
                                <td>609847</td>
                                <td>Diego De La Garza Fern√°ndez</td>
                                <td>UDEM</td>
                                <td>20/09/2024</td>
                                <td>53:15 hrs</td>
                                <td>480 hrs</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 11%"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #6b7280;">11%</span>
                                </td>
                                <td><span class="status-badge status-active">Activo</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewStudentHistory('609847')">Ver Historial</button>
                                </td>
                            </tr>
                            <tr>
                                <td>638219</td>
                                <td>Manuel Eugenio Aguirre Leal</td>
                                <td>UDEM</td>
                                <td>01/10/2024</td>
                                <td>100:30 hrs</td>
                                <td>480 hrs</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 21%"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #6b7280;">21%</span>
                                </td>
                                <td><span class="status-badge status-active">Activo</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewStudentHistory('638219')">Ver Historial</button>
                                </td>
                            </tr>
                            <tr>
                                <td>599678</td>
                                <td>Diana Ruanova Cavazos</td>
                                <td>UDEM</td>
                                <td>15/09/2024</td>
                                <td>184:30 hrs</td>
                                <td>480 hrs</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 38%"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #6b7280;">38%</span>
                                </td>
                                <td><span class="status-badge status-active">Activo</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewStudentHistory('599678')">Ver Historial</button>
                                </td>
                            </tr>
                            <tr>
                                <td>597186</td>
                                <td>Mauricio Alexis Tinajero Bobadilla</td>
                                <td>UDEM</td>
                                <td>20/10/2024</td>
                                <td>121:00 hrs</td>
                                <td>480 hrs</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 25%"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #6b7280;">25%</span>
                                </td>
                                <td><span class="status-badge status-active">Activo</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewStudentHistory('597186')">Ver Historial</button>
                                </td>
                            </tr>
                            <tr>
                                <td>612605</td>
                                <td>Paula Cantu Ceniceros</td>
                                <td>UDEM</td>
                                <td>01/11/2024</td>
                                <td>223:00 hrs</td>
                                <td>480 hrs</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 46%"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #6b7280;">46%</span>
                                </td>
                                <td><span class="status-badge status-active">Activo</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewStudentHistory('612605')">Ver Historial</button>
                                </td>
                            </tr>
                            <tr>
                                <td>629808</td>
                                <td>Luis Carlos Herrera</td>
                                <td>UDEM</td>
                                <td>15/11/2024</td>
                                <td>219:00 hrs</td>
                                <td>480 hrs</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 46%"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #6b7280;">46%</span>
                                </td>
                                <td><span class="status-badge status-active">Activo</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewStudentHistory('629808')">Ver Historial</button>
                                </td>
                            </tr>
                            <tr>
                                <td>636082</td>
                                <td>Jorge Garcia</td>
                                <td>UDEM</td>
                                <td>01/12/2024</td>
                                <td>48:00 hrs</td>
                                <td>480 hrs</td>
                                <td>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: 10%"></div>
                                    </div>
                                    <span style="font-size: 12px; color: #6b7280;">10%</span>
                                </td>
                                <td><span class="status-badge status-active">Activo</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;" onclick="viewStudentHistory('636082')">Ver Historial</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Bonos Section -->
            <div id="bonos" class="section">
                <header class="header">
                    <div>
                        <h1 class="header-title">Gesti√≥n de Bonos</h1>
                        <p class="header-subtitle">Registro de horas bonus otorgadas a estudiantes</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportBonuses()">üì• Exportar</button>
                        <button class="btn btn-primary" onclick="addBonus()">üéÅ Otorgar Bono</button>
                    </div>
                </header>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Alumno</th>
                                <th>Matr√≠cula</th>
                                <th>Raz√≥n del Bono</th>
                                <th>Horas Otorgadas</th>
                                <th>Fecha</th>
                                <th>Otorgado por</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="bonuses-table">
                            <tr>
                                <td>B001</td>
                                <td>Paula Cantu Ceniceros</td>
                                <td>612605</td>
                                <td>Excelencia en Servicio</td>
                                <td>+2 hrs</td>
                                <td>13/01/2025</td>
                                <td>Coordinador</td>
                                <td><span class="status-badge status-completed">Aplicado</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;">Ver</button>
                                </td>
                            </tr>
                            <tr>
                                <td>B002</td>
                                <td>Eugenio Mijares</td>
                                <td>633059</td>
                                <td>Liderazgo en Proyecto</td>
                                <td>+3 hrs</td>
                                <td>10/01/2025</td>
                                <td>Coordinador</td>
                                <td><span class="status-badge status-completed">Aplicado</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;">Ver</button>
                                </td>
                            </tr>
                            <tr>
                                <td>B003</td>
                                <td>Sebasti√°n Gonz√°lez Alfaro</td>
                                <td>595002</td>
                                <td>Participaci√≥n Extraordinaria</td>
                                <td>+1 hr</td>
                                <td>08/01/2025</td>
                                <td>Coordinador</td>
                                <td><span class="status-badge status-completed">Aplicado</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;">Ver</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Asistencia Section -->
            <div id="asistencia" class="section">
                <header class="header">
                    <div>
                        <h1 class="header-title">Control de Asistencia</h1>
                        <p class="header-subtitle">Registro diario de asistencia y verificaci√≥n de equipo de protecci√≥n</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportAttendance()">üì• Exportar</button>
                        <button class="btn btn-primary" onclick="takeAttendance()">‚úÖ Tomar Asistencia</button>
                    </div>
                </header>

                <div class="attendance-container">
                    <div class="attendance-header">
                        <h2>Asistencia del D√≠a: <span id="current-date">15/01/2025</span></h2>
                        <p>Verificar que cada alumno tenga su equipo de protecci√≥n completo</p>
                    </div>

                    <div class="attendance-list">
                        <div class="attendance-item">
                            <div class="student-info">
                                <div class="student-avatar">MG</div>
                                <div class="student-details">
                                    <h3>Mar√≠a Gonz√°lez</h3>
                                    <p>Matr√≠cula: 2023001</p>
                                </div>
                            </div>
                            <div class="attendance-controls">
                                <div class="equipment-checklist">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Casco</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Chaleco</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Guantes</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Botas</span>
                                    </label>
                                </div>
                                <div class="attendance-status">
                                    <button class="btn btn-success" style="padding: 4px 12px; font-size: 12px;">Presente</button>
                                </div>
                            </div>
                        </div>

                        <div class="attendance-item">
                            <div class="student-info">
                                <div class="student-avatar">CR</div>
                                <div class="student-details">
                                    <h3>Carlos Rodr√≠guez</h3>
                                    <p>Matr√≠cula: 2023002</p>
                                </div>
                            </div>
                            <div class="attendance-controls">
                                <div class="equipment-checklist">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Casco</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Chaleco</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox">
                                        <span>Guantes</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Botas</span>
                                    </label>
                                </div>
                                <div class="attendance-status">
                                    <button class="btn btn-warning" style="padding: 4px 12px; font-size: 12px;">Falta Equipo</button>
                                </div>
                            </div>
                        </div>

                        <div class="attendance-item">
                            <div class="student-info">
                                <div class="student-avatar">AM</div>
                                <div class="student-details">
                                    <h3>Ana Mart√≠nez</h3>
                                    <p>Matr√≠cula: 2023003</p>
                                </div>
                            </div>
                            <div class="attendance-controls">
                                <div class="equipment-checklist">
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Casco</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Chaleco</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Guantes</span>
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" checked>
                                        <span>Botas</span>
                                    </label>
                                </div>
                                <div class="attendance-status">
                                    <button class="btn btn-success" style="padding: 4px 12px; font-size: 12px;">Presente</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sanciones Section -->
            <div id="sanciones" class="section">
                <header class="header">
                    <div>
                        <h1 class="header-title">Gesti√≥n de Sanciones</h1>
                        <p class="header-subtitle">Registro de deducciones de horas por sanciones</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportSanctions()">üì• Exportar</button>
                        <button class="btn btn-primary" onclick="addSanction()">‚ö†Ô∏è Aplicar Sanci√≥n</button>
                    </div>
                </header>

                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Alumno</th>
                                <th>Matr√≠cula</th>
                                <th>Raz√≥n de la Sanci√≥n</th>
                                <th>Horas Descontadas</th>
                                <th>Fecha</th>
                                <th>Aplicado por</th>
                                <th>Estado</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="sanctions-table">
                            <tr>
                                <td>S001</td>
                                <td>Luis P√©rez</td>
                                <td>2023004</td>
                                <td>Tardanza sin justificaci√≥n</td>
                                <td>-1 hr</td>
                                <td>12/01/2025</td>
                                <td>Coordinador</td>
                                <td><span class="status-badge status-pending">Aplicada</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;">Ver</button>
                                </td>
                            </tr>
                            <tr>
                                <td>S002</td>
                                <td>Mar√≠a Gonz√°lez</td>
                                <td>2023001</td>
                                <td>Falta de equipo de protecci√≥n</td>
                                <td>-0.5 hrs</td>
                                <td>10/01/2025</td>
                                <td>Coordinador</td>
                                <td><span class="status-badge status-pending">Aplicada</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;">Ver</button>
                                </td>
                            </tr>
                            <tr>
                                <td>S003</td>
                                <td>Carlos Rodr√≠guez</td>
                                <td>2023002</td>
                                <td>Inasistencia sin aviso</td>
                                <td>-2 hrs</td>
                                <td>08/01/2025</td>
                                <td>Coordinador</td>
                                <td><span class="status-badge status-pending">Aplicada</span></td>
                                <td>
                                    <button class="btn btn-secondary" style="padding: 4px 8px; font-size: 12px;">Ver</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

         <!-- Toast Container -->
     <div class="toast-container" id="toastContainer"></div>

     <!-- Student History Modal -->
     <div class="modal-overlay" id="studentHistoryModal">
         <div class="modal">
             <div class="modal-header">
                 <h2 class="modal-title">Historial del Alumno</h2>
                 <button class="modal-close" onclick="closeStudentHistory()">&times;</button>
             </div>
             <div class="modal-body" id="modalBody">
                 <!-- Content will be dynamically populated -->
             </div>
         </div>
     </div>

    <script>
        // Navigation functionality
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links and sections
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                
                // Add active class to clicked link
                this.classList.add('active');
                
                // Show corresponding section
                const sectionId = this.getAttribute('data-section');
                document.getElementById(sectionId).classList.add('active');
            });
        });

        // Charts initialization
        function initializeCharts() {
            // Progress Chart
            const progressCtx = document.getElementById('progressChart').getContext('2d');
            new Chart(progressCtx, {
                type: 'bar',
                data: {
                    labels: ['Eugenio M.', 'Sebasti√°n G.', 'Diego D.L.G.', 'Manuel A.', 'Diana R.', 'Mauricio T.', 'Paula C.', 'Luis C.H.', 'Jorge G.'],
                    datasets: [{
                        label: 'Horas Completadas',
                        data: [267.67, 194, 53.25, 100.5, 184.5, 121, 223, 219, 48],
                        backgroundColor: '#3b82f6',
                        borderColor: '#2563eb',
                        borderWidth: 1
                    }, {
                        label: 'Horas Restantes',
                        data: [212.33, 286, 426.75, 379.5, 295.5, 359, 257, 261, 432],
                        backgroundColor: '#f3f4f6',
                        borderColor: '#d1d5db',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        }
                    },
                    scales: {
                        x: {
                            stacked: true
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            max: 500,
                            title: {
                                display: true,
                                text: 'Horas'
                            }
                        }
                    }
                }
            });


        }

        // Toast notification function
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-message">${message}</div>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('hide');
                setTimeout(() => toast.remove(), 150);
            }, 3000);
        }

        // Export functions
        function exportData() {
            showToast('Exportando datos de servicio social...', 'success');
        }

        function exportStudents() {
            showToast('Exportando lista de alumnos...', 'success');
        }

        function exportBonuses() {
            showToast('Exportando bonos...', 'success');
        }

        function exportAttendance() {
            showToast('Exportando asistencia...', 'success');
        }

        function exportSanctions() {
            showToast('Exportando sanciones...', 'success');
        }

        // Action functions
        function addStudent() {
            showToast('Funcionalidad de agregar alumno en desarrollo...', 'success');
        }

        function addBonus() {
            showToast('Funcionalidad de otorgar bono en desarrollo...', 'success');
        }

        function addSanction() {
            showToast('Funcionalidad de aplicar sanci√≥n en desarrollo...', 'success');
        }

        function takeAttendance() {
            showToast('Funcionalidad de tomar asistencia en desarrollo...', 'success');
        }

                 // Student data for history
         const studentData = {
             '633059': {
                 name: 'Eugenio Mijares',
                 university: 'UDEM',
                 startDate: '01/09/2024',
                 currentHours: 267.67,
                 goalHours: 480,
                 avatar: 'EM',
                 history: [
                     { 
                         fechaRegistro: '15/01/2025 08:30', 
                         fechaActividad: '15/01/2025', 
                         horaInicio: '09:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Limpieza y mantenimiento de √°reas verdes en parques p√∫blicos',
                         nota: 'Excelente trabajo en equipo y puntualidad',
                         activity: 'Limpieza de Parques', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '12/01/2025 14:15', 
                         fechaActividad: '12/01/2025', 
                         horaInicio: '15:00', 
                         horaFin: '18:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Apoyo en organizaci√≥n y catalogaci√≥n de libros en biblioteca universitaria',
                         nota: 'Muy organizado y eficiente en el trabajo',
                         activity: 'Apoyo en Biblioteca', 
                         hours: 3, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '10/01/2025 07:45', 
                         fechaActividad: '10/01/2025', 
                         horaInicio: '08:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Mantenimiento y poda de jardines en instalaciones educativas',
                         nota: 'Demostr√≥ gran responsabilidad y cuidado en el trabajo',
                         activity: 'Mantenimiento de Jardines', 
                         hours: 5, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '08/01/2025 16:20', 
                         fechaActividad: '08/01/2025', 
                         horaInicio: '17:00', 
                         horaFin: '21:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Apoyo educativo en clases de refuerzo para estudiantes de secundaria',
                         nota: 'Excelente comunicaci√≥n con los estudiantes',
                         activity: 'Apoyo Educativo', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '05/01/2025 06:30', 
                         fechaActividad: '05/01/2025', 
                         horaInicio: '07:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Limpieza de calles y recolecci√≥n de basura en colonia residencial',
                         nota: 'Trabajo arduo y comprometido con la comunidad',
                         activity: 'Limpieza de Calles', 
                         hours: 6, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '03/01/2025 10:00', 
                         fechaActividad: '03/01/2025', 
                         horaInicio: '10:00', 
                         horaFin: '12:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Bono otorgado por excelencia en servicio y liderazgo demostrado',
                         nota: 'Liderazgo excepcional y motivaci√≥n al equipo',
                         activity: 'Bono por Excelencia', 
                         hours: 2, 
                         type: 'Bono', 
                         status: 'Aplicado' 
                     },
                     { 
                         fechaRegistro: '01/01/2025 07:00', 
                         fechaActividad: '01/01/2025', 
                         horaInicio: '08:00', 
                         horaFin: '16:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Apoyo en organizaci√≥n y log√≠stica de evento comunitario de fin de a√±o',
                         nota: 'Coordinaci√≥n excelente en la log√≠stica del evento',
                         activity: 'Apoyo en Evento Comunitario', 
                         hours: 8, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     }
                 ],
                 bonuses: [
                     { date: '13/01/2025', reason: 'Excelencia en Servicio', hours: 2, appliedBy: 'Coordinador' },
                     { date: '03/01/2025', reason: 'Liderazgo en Proyecto', hours: 2, appliedBy: 'Coordinador' }
                 ],
                 sanctions: [
                     { date: '10/01/2025', reason: 'Falta de equipo de protecci√≥n', hours: -0.5, appliedBy: 'Coordinador' }
                 ]
             },
             '595002': {
                 name: 'Sebasti√°n Gonz√°lez Alfaro',
                 university: 'UDEM',
                 startDate: '15/08/2024',
                 currentHours: 194,
                 goalHours: 480,
                 avatar: 'SG',
                 history: [
                     { 
                         fechaRegistro: '14/01/2025 13:45', 
                         fechaActividad: '14/01/2025', 
                         horaInicio: '14:00', 
                         horaFin: '17:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Apoyo educativo en clases de matem√°ticas para estudiantes de primaria',
                         nota: 'Excelente pedagog√≠a y paciencia con los ni√±os',
                         activity: 'Apoyo Educativo', 
                         hours: 3, 
                         type: 'Servicio', 
                         status: 'En curso' 
                     },
                     { 
                         fechaRegistro: '11/01/2025 08:20', 
                         fechaActividad: '11/01/2025', 
                         horaInicio: '09:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Mantenimiento y reparaci√≥n de equipos de c√≥mputo en laboratorio',
                         nota: 'Conocimientos t√©cnicos sobresalientes',
                         activity: 'Mantenimiento de Equipos', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '09/01/2025 15:30', 
                         fechaActividad: '09/01/2025', 
                         horaInicio: '16:00', 
                         horaFin: '21:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Apoyo en preparaci√≥n y organizaci√≥n de experimentos en laboratorio de qu√≠mica',
                         nota: 'Precisi√≥n y atenci√≥n al detalle en experimentos',
                         activity: 'Apoyo en Laboratorio', 
                         hours: 5, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '07/01/2025 10:15', 
                         fechaActividad: '07/01/2025', 
                         horaInicio: '11:00', 
                         horaFin: '14:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Limpieza y mantenimiento de instalaciones educativas',
                         nota: 'Trabajo meticuloso y responsable',
                         activity: 'Limpieza de Instalaciones', 
                         hours: 3, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '05/01/2025 12:00', 
                         fechaActividad: '05/01/2025', 
                         horaInicio: '12:00', 
                         horaFin: '15:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Bono otorgado por demostrar liderazgo en proyecto comunitario',
                         nota: 'Liderazgo natural y capacidad de motivaci√≥n',
                         activity: 'Bono por Liderazgo', 
                         hours: 3, 
                         type: 'Bono', 
                         status: 'Aplicado' 
                     },
                     { 
                         fechaRegistro: '03/01/2025 09:00', 
                         fechaActividad: '03/01/2025', 
                         horaInicio: '10:00', 
                         horaFin: '16:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Apoyo en taller de manualidades para ni√±os de la comunidad',
                         nota: 'Creatividad y paciencia excepcionales con los ni√±os',
                         activity: 'Apoyo en Taller', 
                         hours: 6, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     }
                 ],
                 bonuses: [
                     { date: '10/01/2025', reason: 'Liderazgo en Proyecto', hours: 3, appliedBy: 'Coordinador' },
                     { date: '05/01/2025', reason: 'Iniciativa Extraordinaria', hours: 3, appliedBy: 'Coordinador' }
                 ],
                 sanctions: [
                     { date: '08/01/2025', reason: 'Inasistencia sin aviso', hours: -2, appliedBy: 'Coordinador' }
                 ]
             },
             '609847': {
                 name: 'Diego De La Garza Fern√°ndez',
                 university: 'UDEM',
                 startDate: '20/09/2024',
                 currentHours: 53.25,
                 goalHours: 480,
                 avatar: 'DD',
                 history: [
                     { 
                         fechaRegistro: '13/01/2025 11:30', 
                         fechaActividad: '13/01/2025', 
                         horaInicio: '12:00', 
                         horaFin: '16:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Apoyo en organizaci√≥n y catalogaci√≥n de libros en biblioteca municipal',
                         nota: 'Excelente organizaci√≥n y atenci√≥n al detalle',
                         activity: 'Apoyo en Biblioteca', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '11/01/2025 07:45', 
                         fechaActividad: '11/01/2025', 
                         horaInicio: '08:00', 
                         horaFin: '11:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Limpieza y mantenimiento de aulas en escuela primaria',
                         nota: 'Trabajo diligente y cuidadoso',
                         activity: 'Limpieza de Aulas', 
                         hours: 3, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '09/01/2025 14:00', 
                         fechaActividad: '09/01/2025', 
                         horaInicio: '15:00', 
                         horaFin: '20:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Apoyo en organizaci√≥n y log√≠stica de evento cultural comunitario',
                         nota: 'Coordinaci√≥n eficiente y trabajo en equipo',
                         activity: 'Apoyo en Evento', 
                         hours: 5, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '07/01/2025 08:15', 
                         fechaActividad: '07/01/2025', 
                         horaInicio: '09:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Mantenimiento y poda de jardines en parque p√∫blico',
                         nota: 'Cuidado y esmero en el mantenimiento de √°reas verdes',
                         activity: 'Mantenimiento de Jardines', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     },
                     { 
                         fechaRegistro: '05/01/2025 16:30', 
                         fechaActividad: '05/01/2025', 
                         horaInicio: '16:30', 
                         horaFin: '17:30', 
                         multiplicador: 1.0, 
                         descripcion: 'Bono otorgado por participaci√≥n extraordinaria en actividades comunitarias',
                         nota: 'Participaci√≥n activa y compromiso con la comunidad',
                         activity: 'Bono por Participaci√≥n', 
                         hours: 1, 
                         type: 'Bono', 
                         status: 'Aplicado' 
                     },
                     { 
                         fechaRegistro: '03/01/2025 10:00', 
                         fechaActividad: '03/01/2025', 
                         horaInicio: '11:00', 
                         horaFin: '17:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Apoyo en taller de arte y manualidades para adultos mayores',
                         nota: 'Empat√≠a y paciencia excepcionales con adultos mayores',
                         activity: 'Apoyo en Taller', 
                         hours: 6, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     }
                 ],
                 bonuses: [
                     { date: '08/01/2025', reason: 'Participaci√≥n Extraordinaria', hours: 1, appliedBy: 'Coordinador' }
                 ],
                 sanctions: [                 ]
             },
             '638219': {
                 name: 'Manuel Eugenio Aguirre Leal',
                 university: 'UDEM',
                 startDate: '01/10/2024',
                 currentHours: 100.5,
                 goalHours: 480,
                 avatar: 'MA',
                 history: [
                     { 
                         fechaRegistro: '15/01/2025 08:30', 
                         fechaActividad: '15/01/2025', 
                         horaInicio: '09:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Limpieza y mantenimiento de √°reas verdes en parques p√∫blicos',
                         nota: 'Excelente trabajo en equipo y puntualidad',
                         activity: 'Limpieza de Parques', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     }
                 ],
                 bonuses: [
                     { date: '10/01/2025', reason: 'Liderazgo en Proyecto', hours: 2, appliedBy: 'Coordinador' }
                 ],
                 sanctions: []
             },
             '599678': {
                 name: 'Diana Ruanova Cavazos',
                 university: 'UDEM',
                 startDate: '15/09/2024',
                 currentHours: 184.5,
                 goalHours: 480,
                 avatar: 'DR',
                 history: [
                     { 
                         fechaRegistro: '15/01/2025 08:30', 
                         fechaActividad: '15/01/2025', 
                         horaInicio: '09:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Limpieza y mantenimiento de √°reas verdes en parques p√∫blicos',
                         nota: 'Excelente trabajo en equipo y puntualidad',
                         activity: 'Limpieza de Parques', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     }
                 ],
                 bonuses: [
                     { date: '10/01/2025', reason: 'Liderazgo en Proyecto', hours: 2, appliedBy: 'Coordinador' }
                 ],
                 sanctions: []
             },
             '597186': {
                 name: 'Mauricio Alexis Tinajero Bobadilla',
                 university: 'UDEM',
                 startDate: '20/10/2024',
                 currentHours: 121,
                 goalHours: 480,
                 avatar: 'MT',
                 history: [
                     { 
                         fechaRegistro: '15/01/2025 08:30', 
                         fechaActividad: '15/01/2025', 
                         horaInicio: '09:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Limpieza y mantenimiento de √°reas verdes en parques p√∫blicos',
                         nota: 'Excelente trabajo en equipo y puntualidad',
                         activity: 'Limpieza de Parques', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     }
                 ],
                 bonuses: [
                     { date: '10/01/2025', reason: 'Liderazgo en Proyecto', hours: 2, appliedBy: 'Coordinador' }
                 ],
                 sanctions: []
             },
             '612605': {
                 name: 'Paula Cantu Ceniceros',
                 university: 'UDEM',
                 startDate: '01/11/2024',
                 currentHours: 223,
                 goalHours: 480,
                 avatar: 'PC',
                 history: [
                     { 
                         fechaRegistro: '15/01/2025 08:30', 
                         fechaActividad: '15/01/2025', 
                         horaInicio: '09:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Limpieza y mantenimiento de √°reas verdes en parques p√∫blicos',
                         nota: 'Excelente trabajo en equipo y puntualidad',
                         activity: 'Limpieza de Parques', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     }
                 ],
                 bonuses: [
                     { date: '10/01/2025', reason: 'Liderazgo en Proyecto', hours: 2, appliedBy: 'Coordinador' }
                 ],
                 sanctions: []
             },
             '629808': {
                 name: 'Luis Carlos Herrera',
                 university: 'UDEM',
                 startDate: '15/11/2024',
                 currentHours: 219,
                 goalHours: 480,
                 avatar: 'LH',
                 history: [
                     { 
                         fechaRegistro: '15/01/2025 08:30', 
                         fechaActividad: '15/01/2025', 
                         horaInicio: '09:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Limpieza y mantenimiento de √°reas verdes en parques p√∫blicos',
                         nota: 'Excelente trabajo en equipo y puntualidad',
                         activity: 'Limpieza de Parques', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     }
                 ],
                 bonuses: [
                     { date: '10/01/2025', reason: 'Liderazgo en Proyecto', hours: 2, appliedBy: 'Coordinador' }
                 ],
                 sanctions: []
             },
             '636082': {
                 name: 'Jorge Garcia',
                 university: 'UDEM',
                 startDate: '01/12/2024',
                 currentHours: 48,
                 goalHours: 480,
                 avatar: 'JG',
                 history: [
                     { 
                         fechaRegistro: '15/01/2025 08:30', 
                         fechaActividad: '15/01/2025', 
                         horaInicio: '09:00', 
                         horaFin: '13:00', 
                         multiplicador: 1.0, 
                         descripcion: 'Limpieza y mantenimiento de √°reas verdes en parques p√∫blicos',
                         nota: 'Excelente trabajo en equipo y puntualidad',
                         activity: 'Limpieza de Parques', 
                         hours: 4, 
                         type: 'Servicio', 
                         status: 'Completado' 
                     }
                 ],
                 bonuses: [
                     { date: '10/01/2025', reason: 'Liderazgo en Proyecto', hours: 2, appliedBy: 'Coordinador' }
                 ],
                 sanctions: []
             }
         };

         function viewStudentHistory(studentId) {
             const student = studentData[studentId];
             if (!student) {
                 showToast('Informaci√≥n del alumno no encontrada', 'error');
                 return;
             }

             const modal = document.getElementById('studentHistoryModal');
             const modalBody = document.getElementById('modalBody');

             // Calculate totals
             const totalServiceHours = student.history
                 .filter(item => item.type === 'Servicio')
                 .reduce((sum, item) => sum + item.hours, 0);
             
             const totalBonusHours = student.bonuses.reduce((sum, bonus) => sum + bonus.hours, 0);
             const totalSanctionHours = student.sanctions.reduce((sum, sanction) => sum + sanction.hours, 0);

             modalBody.innerHTML = `
                 <div class="student-profile">
                     <div class="student-profile-avatar">${student.avatar}</div>
                     <div class="student-profile-info">
                         <h3>${student.name}</h3>
                         <p>Matr√≠cula: ${studentId}</p>
                         <p>Universidad: ${student.university}</p>
                         <p>Fecha de Inicio: ${student.startDate}</p>
                     </div>
                 </div>

                 <div class="history-section">
                     <h3 class="history-section-title">üìã Actividades de Servicio</h3>
                     ${student.history.map((item, index) => `
                         <div class="history-item" data-student-id="${studentId}" data-item-index="${index}">
                             <div class="history-header">
                                 <div class="history-info">
                                     <div class="history-activity">${item.activity}</div>
                                     <div class="history-details">${item.type} ‚Ä¢ ${item.status}</div>
                                 </div>
                                 <div class="history-hours">${item.hours > 0 ? '+' : ''}${item.hours} hrs</div>
                                 <div class="history-date">${item.fechaActividad}</div>
                             </div>
                             <div class="history-body">
                                 <div class="history-fields">
                                     <div class="history-field">
                                         <div class="history-field-label">Fecha de Registro</div>
                                         <div class="history-field-value" data-field="fechaRegistro">${item.fechaRegistro}</div>
                                         <input type="text" class="history-field-input" data-field="fechaRegistro" value="${item.fechaRegistro}" style="display: none;">
                                     </div>
                                     <div class="history-field">
                                         <div class="history-field-label">Fecha de Actividad</div>
                                         <div class="history-field-value" data-field="fechaActividad">${item.fechaActividad}</div>
                                         <input type="text" class="history-field-input" data-field="fechaActividad" value="${item.fechaActividad}" style="display: none;">
                                     </div>
                                     <div class="history-field">
                                         <div class="history-field-label">Hora Inicio</div>
                                         <div class="history-field-value" data-field="horaInicio">${item.horaInicio}</div>
                                         <input type="text" class="history-field-input" data-field="horaInicio" value="${item.horaInicio}" style="display: none;">
                                     </div>
                                     <div class="history-field">
                                         <div class="history-field-label">Hora Fin</div>
                                         <div class="history-field-value" data-field="horaFin">${item.horaFin}</div>
                                         <input type="text" class="history-field-input" data-field="horaFin" value="${item.horaFin}" style="display: none;">
                                     </div>
                                     <div class="history-field">
                                         <div class="history-field-label">Multiplicador</div>
                                         <div class="history-field-value" data-field="multiplicador">${item.multiplicador}x</div>
                                         <input type="text" class="history-field-input" data-field="multiplicador" value="${item.multiplicador}" style="display: none;">
                                     </div>
                                 </div>
                                 <div class="history-description">
                                     <div class="history-description-label">Descripci√≥n</div>
                                     <div class="history-description-text" data-field="descripcion">${item.descripcion}</div>
                                     <textarea class="history-description-input" data-field="descripcion" style="display: none;">${item.descripcion}</textarea>
                                 </div>
                                 ${item.nota ? `
                                 <div class="history-note">
                                     <div class="history-note-label">Nota</div>
                                     <div class="history-note-text" data-field="nota">${item.nota}</div>
                                     <textarea class="history-note-input" data-field="nota" style="display: none;">${item.nota}</textarea>
                                 </div>
                                 ` : `
                                 <div class="history-note" style="display: none;">
                                     <div class="history-note-label">Nota</div>
                                     <div class="history-note-text" data-field="nota"></div>
                                     <textarea class="history-note-input" data-field="nota" placeholder="Agregar una nota..."></textarea>
                                 </div>
                                 `}
                                 <div class="history-actions">
                                     <button class="btn-edit" onclick="editHistoryItem('${studentId}', ${index})">‚úèÔ∏è Editar</button>
                                     <button class="btn-save" onclick="saveHistoryItem('${studentId}', ${index})" style="display: none;">üíæ Guardar</button>
                                     <button class="btn-cancel" onclick="cancelEditHistoryItem('${studentId}', ${index})" style="display: none;">‚ùå Cancelar</button>
                                 </div>
                             </div>
                         </div>
                     `).join('')}
                 </div>

                 ${student.bonuses.length > 0 ? `
                 <div class="history-section">
                     <h3 class="history-section-title">üéÅ Bonos Otorgados</h3>
                     ${student.bonuses.map(bonus => `
                         <div class="history-item">
                             <div class="history-info">
                                 <div class="history-activity">${bonus.reason}</div>
                                 <div class="history-details">Otorgado por: ${bonus.appliedBy}</div>
                             </div>
                             <div class="history-hours">+${bonus.hours} hrs</div>
                             <div class="history-date">${bonus.date}</div>
                         </div>
                     `).join('')}
                 </div>
                 ` : ''}

                 ${student.sanctions.length > 0 ? `
                 <div class="history-section">
                     <h3 class="history-section-title">‚ö†Ô∏è Sanciones Aplicadas</h3>
                     ${student.sanctions.map(sanction => `
                         <div class="history-item">
                             <div class="history-info">
                                 <div class="history-activity">${sanction.reason}</div>
                                 <div class="history-details">Aplicado por: ${sanction.appliedBy}</div>
                             </div>
                             <div class="history-hours">${sanction.hours} hrs</div>
                             <div class="history-date">${sanction.date}</div>
                         </div>
                     `).join('')}
                 </div>
                 ` : ''}

                 <div class="total-hours">
                     <h4>Resumen de Horas</h4>
                     <div class="total-value">${student.currentHours} / ${student.goalHours} hrs</div>
                     <div style="font-size: 12px; opacity: 0.8; margin-top: 4px;">
                         Servicio: ${totalServiceHours}hrs | Bonos: +${totalBonusHours}hrs | Sanciones: ${totalSanctionHours}hrs
                     </div>
                 </div>
             `;

             modal.classList.add('show');
             setTimeout(() => {
                 modal.querySelector('.modal').classList.add('show');
             }, 10);
         }

         function closeStudentHistory() {
             const modal = document.getElementById('studentHistoryModal');
             modal.querySelector('.modal').classList.remove('show');
             setTimeout(() => {
                 modal.classList.remove('show');
             }, 300);
         }

         function editHistoryItem(studentId, itemIndex) {
             const historyItem = document.querySelector(`[data-student-id="${studentId}"][data-item-index="${itemIndex}"]`);
             if (!historyItem) return;

             // Hide all value elements and show input elements
             const valueElements = historyItem.querySelectorAll('.history-field-value, .history-description-text, .history-note-text');
             const inputElements = historyItem.querySelectorAll('.history-field-input, .history-description-input, .history-note-input');
             
             valueElements.forEach(el => el.style.display = 'none');
             inputElements.forEach(el => el.style.display = 'block');

             // Show/hide action buttons
             const editBtn = historyItem.querySelector('.btn-edit');
             const saveBtn = historyItem.querySelector('.btn-save');
             const cancelBtn = historyItem.querySelector('.btn-cancel');
             
             editBtn.style.display = 'none';
             saveBtn.style.display = 'inline-block';
             cancelBtn.style.display = 'inline-block';

             // Show note section if it was hidden
             const noteSection = historyItem.querySelector('.history-note');
             if (noteSection) {
                 noteSection.style.display = 'block';
             }
         }

         function saveHistoryItem(studentId, itemIndex) {
             const historyItem = document.querySelector(`[data-student-id="${studentId}"][data-item-index="${itemIndex}"]`);
             if (!historyItem) return;

             // Get all input values
             const inputs = historyItem.querySelectorAll('input, textarea');
             const updatedData = {};

             inputs.forEach(input => {
                 const fieldName = input.dataset.field;
                 if (fieldName) {
                     updatedData[fieldName] = input.value;
                 }
             });

             // Update the data in studentData
             if (studentData[studentId] && studentData[studentId].history[itemIndex]) {
                 Object.assign(studentData[studentId].history[itemIndex], updatedData);
                 
                 // Update the display
                 const valueElements = historyItem.querySelectorAll('.history-field-value, .history-description-text, .history-note-text');
                 valueElements.forEach(el => {
                     const fieldName = el.dataset.field;
                     if (fieldName && updatedData[fieldName] !== undefined) {
                         if (fieldName === 'multiplicador') {
                             el.textContent = updatedData[fieldName] + 'x';
                         } else {
                             el.textContent = updatedData[fieldName];
                         }
                     }
                 });

                 // Hide input elements and show value elements
                 const inputElements = historyItem.querySelectorAll('.history-field-input, .history-description-input, .history-note-input');
                 inputElements.forEach(el => el.style.display = 'none');
                 valueElements.forEach(el => el.style.display = 'block');

                 // Show/hide action buttons
                 const editBtn = historyItem.querySelector('.btn-edit');
                 const saveBtn = historyItem.querySelector('.btn-save');
                 const cancelBtn = historyItem.querySelector('.btn-cancel');
                 
                 editBtn.style.display = 'inline-block';
                 saveBtn.style.display = 'none';
                 cancelBtn.style.display = 'none';

                 showToast('Registro actualizado exitosamente', 'success');
             }
         }

         function cancelEditHistoryItem(studentId, itemIndex) {
             const historyItem = document.querySelector(`[data-student-id="${studentId}"][data-item-index="${itemIndex}"]`);
             if (!historyItem) return;

             // Reset input values to original data
             const student = studentData[studentId];
             const item = student.history[itemIndex];
             
             const inputs = historyItem.querySelectorAll('input, textarea');
             inputs.forEach(input => {
                 const fieldName = input.dataset.field;
                 if (fieldName && item[fieldName] !== undefined) {
                     input.value = item[fieldName];
                 }
             });

             // Hide input elements and show value elements
             const valueElements = historyItem.querySelectorAll('.history-field-value, .history-description-text, .history-note-text');
             const inputElements = historyItem.querySelectorAll('.history-field-input, .history-description-input, .history-note-input');
             
             valueElements.forEach(el => el.style.display = 'block');
             inputElements.forEach(el => el.style.display = 'none');

             // Show/hide action buttons
             const editBtn = historyItem.querySelector('.btn-edit');
             const saveBtn = historyItem.querySelector('.btn-save');
             const cancelBtn = historyItem.querySelector('.btn-cancel');
             
             editBtn.style.display = 'inline-block';
             saveBtn.style.display = 'none';
             cancelBtn.style.display = 'none';
         }

         // Close modal when clicking outside
         document.getElementById('studentHistoryModal').addEventListener('click', function(e) {
             if (e.target === this) {
                 closeStudentHistory();
             }
         });

         // Function to calculate and update statistics
         function updateStatistics() {
             let totalCompletedHours = 0;
             let totalGoalHours = 0;
             let graduatingSoonCount = 0;
             let activeStudentsCount = 0;

             // Calculate statistics from student data
             Object.values(studentData).forEach(student => {
                 totalCompletedHours += student.currentHours;
                 totalGoalHours += student.goalHours;
                 activeStudentsCount++;
                 
                 // Check if student is due to graduate soon (50 hours or less remaining)
                 const remainingHours = student.goalHours - student.currentHours;
                 if (remainingHours <= 50) {
                     graduatingSoonCount++;
                 }
             });

             const totalPendingHours = totalGoalHours - totalCompletedHours;

             // Update the statistics in the DOM
             document.getElementById('stat-active').textContent = activeStudentsCount;
             document.getElementById('stat-completed').innerHTML = Math.round(totalCompletedHours).toLocaleString() + '<span class="stat-unit">hrs</span>';
             document.getElementById('stat-graduating').innerHTML = graduatingSoonCount + '<span class="stat-unit">alumnos</span>';
             document.getElementById('stat-total').innerHTML = Math.round(totalGoalHours).toLocaleString() + '<span class="stat-unit">hrs</span>';
         }

        // Initialize charts when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            updateStatistics(); // Update statistics on page load
            initializeTableFilters(); // Initialize table filters
        });

        // Google Sheets-like Table Filters
        let activeFilters = {};
        let originalTableData = [];
        let currentSort = { column: null, direction: null };

        function initializeTableFilters() {
            // Store original table data
            const tableBody = document.getElementById('students-table');
            const rows = Array.from(tableBody.querySelectorAll('tr'));
            originalTableData = rows.map(row => ({
                element: row,
                data: extractRowData(row)
            }));

            // Add click event listeners to filterable headers
            const filterableHeaders = document.querySelectorAll('.filterable-header');
            filterableHeaders.forEach(header => {
                header.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFilterDropdown(header);
                });

                // Initialize filter dropdown functionality
                const dropdown = header.querySelector('.filter-dropdown');
                const searchInput = dropdown.querySelector('.filter-search');
                const clearBtn = dropdown.querySelector('.filter-btn.clear');
                const applyBtn = dropdown.querySelector('.filter-btn.apply');

                // Search functionality
                searchInput.addEventListener('input', (e) => {
                    filterOptionsInDropdown(header, e.target.value);
                });

                // Clear filter
                clearBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    clearFilter(header);
                });

                // Apply filter
                applyBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    e.preventDefault();
                    applyFilter(header);
                });

                // Sort buttons
                const sortAscBtn = dropdown.querySelector('.sort-asc');
                const sortDescBtn = dropdown.querySelector('.sort-desc');

                console.log('Found sort buttons for column:', header.dataset.column, {
                    asc: sortAscBtn,
                    desc: sortDescBtn
                });

                sortAscBtn.addEventListener('click', (e) => {
                    console.log('Asc button clicked for column:', header.dataset.column);
                    e.stopPropagation();
                    e.preventDefault();
                    sortTable(header.dataset.column, 'asc');
                });

                sortDescBtn.addEventListener('click', (e) => {
                    console.log('Desc button clicked for column:', header.dataset.column);
                    e.stopPropagation();
                    e.preventDefault();
                    sortTable(header.dataset.column, 'desc');
                });
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', closeAllDropdowns);

            // Initialize filter options for each column
            populateFilterOptions();
        }

        function toggleFilterDropdown(header) {
            const dropdown = header.querySelector('.filter-dropdown');
            const isOpen = dropdown.classList.contains('show');

            // Close all other dropdowns
            closeAllDropdowns();

            if (!isOpen) {
                // Position the dropdown properly
                positionDropdown(header, dropdown);
                
                dropdown.classList.add('show');
                header.classList.add('active');
                
                // Focus on search input
                const searchInput = dropdown.querySelector('.filter-search');
                setTimeout(() => searchInput.focus(), 100);
            }
        }

        function positionDropdown(header, dropdown) {
            // Reset any previous positioning
            dropdown.classList.remove('dropdown-up');
            
            // Create a temporary clone to measure without affecting the original
            const clone = dropdown.cloneNode(true);
            clone.style.position = 'absolute';
            clone.style.visibility = 'hidden';
            clone.style.display = 'flex';
            clone.style.top = '0';
            clone.style.left = '0';
            document.body.appendChild(clone);
            
            const headerRect = header.getBoundingClientRect();
            const cloneRect = clone.getBoundingClientRect();
            const viewportHeight = window.innerHeight;
            
            // Check if dropdown would go below viewport
            const spaceBelow = viewportHeight - headerRect.bottom;
            const dropdownHeight = cloneRect.height;
            
            // If not enough space below, position above
            if (spaceBelow < dropdownHeight + 10) {
                dropdown.classList.add('dropdown-up');
            }
            
            // Remove the clone
            document.body.removeChild(clone);
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.filter-dropdown').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
            document.querySelectorAll('.filterable-header').forEach(header => {
                header.classList.remove('active');
            });
        }

        function populateFilterOptions() {
            const filterableHeaders = document.querySelectorAll('.filterable-header');
            
            filterableHeaders.forEach(header => {
                const column = header.dataset.column;
                const optionsContainer = header.querySelector('.filter-options');
                const uniqueValues = getUniqueValuesForColumn(column);
                
                optionsContainer.innerHTML = '';
                uniqueValues.forEach(value => {
                    const option = document.createElement('div');
                    option.className = 'filter-option';
                    option.innerHTML = `
                        <input type="checkbox" id="filter-${column}-${value}" value="${value}">
                        <label for="filter-${column}-${value}">${value}</label>
                    `;
                    optionsContainer.appendChild(option);
                });
            });
        }

        function getUniqueValuesForColumn(column) {
            const values = new Set();
            
            originalTableData.forEach(rowData => {
                let value = rowData.data[column];
                
                // Format value based on column type
                switch (column) {
                    case 'progreso':
                        // Extract percentage from progress bar
                        const progressText = rowData.element.querySelector('.progress-bar + span');
                        if (progressText) {
                            value = progressText.textContent.trim();
                        }
                        break;
                    case 'horas':
                        // Keep original format for hours
                        break;
                    case 'meta':
                        // Keep original format for meta
                        break;
                    default:
                        // For other columns, use as is
                        break;
                }
                
                if (value !== undefined && value !== null && value !== '') {
                    values.add(value);
                }
            });
            
            return Array.from(values).sort();
        }

        function extractRowData(row) {
            const cells = row.querySelectorAll('td');
            return {
                matricula: cells[0]?.textContent?.trim() || '',
                nombre: cells[1]?.textContent?.trim() || '',
                universidad: cells[2]?.textContent?.trim() || '',
                fecha: cells[3]?.textContent?.trim() || '',
                horas: cells[4]?.textContent?.trim() || '',
                meta: cells[5]?.textContent?.trim() || '',
                progreso: cells[6]?.textContent?.trim() || '',
                estado: cells[7]?.textContent?.trim() || ''
            };
        }

        function filterOptionsInDropdown(header, searchTerm) {
            const options = header.querySelectorAll('.filter-option');
            const term = searchTerm.toLowerCase();
            
            options.forEach(option => {
                const label = option.querySelector('label').textContent.toLowerCase();
                if (label.includes(term)) {
                    option.style.display = 'flex';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        function clearFilter(header) {
            console.log('Clear filter called for column:', header.dataset.column);
            const column = header.dataset.column;
            const checkboxes = header.querySelectorAll('input[type="checkbox"]');
            const indicator = header.querySelector('.active-filter-indicator');
            
            // Uncheck all checkboxes
            checkboxes.forEach(checkbox => checkbox.checked = false);
            
            // Remove filter from active filters
            delete activeFilters[column];
            
            // Hide indicator
            indicator.style.display = 'none';
            header.classList.remove('has-filter');
            
            // Apply filters
            applyAllFilters();
        }

        function applyFilter(header) {
            console.log('Apply filter called for column:', header.dataset.column);
            const column = header.dataset.column;
            const checkboxes = header.querySelectorAll('input[type="checkbox"]:checked');
            const indicator = header.querySelector('.active-filter-indicator');
            
            if (checkboxes.length > 0) {
                const selectedValues = Array.from(checkboxes).map(cb => cb.value);
                activeFilters[column] = selectedValues;
                console.log('Selected values:', selectedValues);
                
                // Show indicator
                indicator.style.display = 'block';
                header.classList.add('has-filter');
            } else {
                delete activeFilters[column];
                indicator.style.display = 'none';
                header.classList.remove('has-filter');
            }
            
            // Close dropdown
            header.querySelector('.filter-dropdown').classList.remove('show');
            header.classList.remove('active');
            
            // Apply filters
            applyAllFilters();
        }

        function applyAllFilters() {
            originalTableData.forEach(rowData => {
                const row = rowData.element;
                const data = rowData.data;
                let shouldShow = true;
                
                // Check each active filter
                Object.entries(activeFilters).forEach(([column, values]) => {
                    let cellValue = data[column];
                    
                    // Format value based on column type for comparison
                    switch (column) {
                        case 'progreso':
                            const progressText = row.querySelector('.progress-bar + span');
                            if (progressText) {
                                cellValue = progressText.textContent.trim();
                            }
                            break;
                        case 'horas':
                        case 'meta':
                            // Keep original format for comparison
                            break;
                        default:
                            // For other columns, use as is
                            break;
                    }
                    
                    if (!values.includes(cellValue)) {
                        shouldShow = false;
                    }
                });
                
                // Show/hide row based on filter results
                row.style.display = shouldShow ? '' : 'none';
            });

            // Apply current sort if any
            if (currentSort.column && currentSort.direction) {
                applySort();
            }
        }

        function sortTable(column, direction) {
            console.log('Sorting table by:', column, direction);
            
            // Update current sort
            currentSort.column = column;
            currentSort.direction = direction;
            
            // Update sort button states
            updateSortButtonStates(column, direction);
            
            // Apply the sort
            applySort();
            
            // Close the dropdown after sorting
            const activeHeader = document.querySelector('.filterable-header.active');
            if (activeHeader) {
                activeHeader.querySelector('.filter-dropdown').classList.remove('show');
                activeHeader.classList.remove('active');
            }
        }

        function updateSortButtonStates(activeColumn, activeDirection) {
            // Reset all sort buttons
            document.querySelectorAll('.sort-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Activate the current sort button
            const activeHeader = document.querySelector(`[data-column="${activeColumn}"]`);
            if (activeHeader) {
                const activeBtn = activeHeader.querySelector(`.sort-${activeDirection}`);
                if (activeBtn) {
                    activeBtn.classList.add('active');
                }
            }
        }

        function applySort() {
            if (!currentSort.column || !currentSort.direction) {
                console.log('No sort criteria set');
                return;
            }
            
            console.log('Applying sort:', currentSort.column, currentSort.direction);
            
            const tableBody = document.getElementById('students-table');
            const visibleRows = Array.from(tableBody.querySelectorAll('tr')).filter(row => 
                row.style.display !== 'none'
            );
            
            console.log('Visible rows to sort:', visibleRows.length);
            
            // Sort the visible rows
            visibleRows.sort((a, b) => {
                const aData = extractRowData(a);
                const bData = extractRowData(b);
                
                let aValue = aData[currentSort.column];
                let bValue = bData[currentSort.column];
                
                // Format values for comparison based on column type
                switch (currentSort.column) {
                    case 'matricula':
                        aValue = parseInt(aValue) || 0;
                        bValue = parseInt(bValue) || 0;
                        break;
                    case 'horas':
                        // Convert HH:MM format to decimal hours for comparison
                        aValue = convertTimeToDecimal(aValue);
                        bValue = convertTimeToDecimal(bValue);
                        break;
                    case 'meta':
                        aValue = parseInt(aValue.replace(' hrs', '')) || 0;
                        bValue = parseInt(bValue.replace(' hrs', '')) || 0;
                        break;
                    case 'progreso':
                        const aProgressText = a.querySelector('.progress-bar + span');
                        const bProgressText = b.querySelector('.progress-bar + span');
                        aValue = parseInt(aProgressText?.textContent?.replace('%', '') || '0');
                        bValue = parseInt(bProgressText?.textContent?.replace('%', '') || '0');
                        break;
                    case 'fecha':
                        // Convert DD/MM/YYYY to Date object for comparison
                        aValue = new Date(aValue.split('/').reverse().join('-'));
                        bValue = new Date(bValue.split('/').reverse().join('-'));
                        break;
                    default:
                        // For text columns, use string comparison
                        aValue = aValue.toLowerCase();
                        bValue = bValue.toLowerCase();
                        break;
                }
                
                // Compare values
                console.log(`Comparing: ${aValue} vs ${bValue} (${currentSort.direction})`);
                if (aValue < bValue) return currentSort.direction === 'asc' ? -1 : 1;
                if (aValue > bValue) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
            
            // Reorder rows in the table
            visibleRows.forEach(row => {
                tableBody.appendChild(row);
            });
        }

        function convertTimeToDecimal(timeStr) {
            if (!timeStr) return 0;
            const match = timeStr.match(/(\d+):(\d+)/);
            if (match) {
                const hours = parseInt(match[1]);
                const minutes = parseInt(match[2]);
                return hours + (minutes / 60);
            }
            return 0;
        }
    </script>
</body>
</html>
